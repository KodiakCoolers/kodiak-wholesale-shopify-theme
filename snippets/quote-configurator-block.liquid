{% comment %}
Quote Configurator Block - Adapted from quote_popup.liquid
This is an inline version without modal functionality
{% endcomment %}

<link
  rel="stylesheet"
  href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
/>
<link
  rel="stylesheet"
  href="{{ "quote-configurator-block.css" | asset_url }}"
/>

<script>
  let fleece = "{{ product.metafields.custom.fleece }}";
  let design_files ="{{product.metafields.custom.design_files}}";
</script>
<script
  src="{{ "quote-configurator-block.js" | asset_url }}"
  defer
></script>
<script type="application/json" id="product_json">{{ product | json }}</script>
<script id="stock_json">
  let variantStock = {};
  {% for variant in product.variants %}
    variantStock[{{- variant.id -}}] = {{ variant.inventory_quantity }};
  {% endfor %}
</script>

<div class="quote-configurator-block" {{ block.shopify_attributes }}>
  <div class="quote-configurator-content">
    <h2 class="section-title">ENTER CUSTOM PRINT DETAILS</h2>
    
    <div class="print-details-section">
          <!-- Type of print is always screen printing, so hide this section -->
          <input type="hidden" name="type" value="screen" />
      <!-- Ink Colors Section -->
      <div class="ink-colors-section">
        <h3 class="section-heading">Select the number of ink colors in your design.</h3>
        <div class="color-selectors">
          <select name="colorFront" id="colorFront" onchange="chooseColorsFront(this.value)">
            <option value="0">No Front Design</option>
            <option value="1" selected>1 Front Print Color</option>
            <option value="2">2 Front Print Colors</option>
            <option value="3">3 Front Print Colors</option>
            <option value="4">4 Front Print Colors</option>
            <option value="5">5 Front Print Colors</option>
          </select>
          
          <select name="colorBack" id="colorBack" onchange="chooseColorsBack(this.value)">
            <option value="0" selected>No Back Design</option>
            <option value="1">1 Back Print Color</option>
            <option value="2">2 Back Print Colors</option>
            <option value="3">3 Back Print Colors</option>
            <option value="4">4 Back Print Colors</option>
            <option value="5">5 Back Print Colors</option>
          </select>
        </div>
      </div>

      <!-- Upload Section -->
      <div class="upload-section">
        <h3 class="section-heading">Upload your best design files. Max file size 10MB.</h3>
        <p class="upload-subtitle">Vector files preferred. We'll create proofs for your review before it prints.</p>
        
        <!-- Front Design Upload -->
        <div class="upload-box" id="front-upload-box">
          <h4 class="upload-title">Upload Front Design</h4>
          <div class="file-drop-zone" id="front-drop-zone">
            <input type="file" id="frontDesignUpload" accept="image/*,.ai,.eps,.pdf,.psd" multiple style="display: none;">
            <div class="upload-content" onclick="document.getElementById('frontDesignUpload').click();">
              <button type="button" class="upload-btn">Choose file</button>
              <span class="upload-text">or drop file to upload</span>
            </div>
            <div class="file-preview" id="front-file-preview"></div>
          </div>
        </div>
        
        <!-- Back Design Upload -->
        <div class="upload-box" id="back-upload-box" style="display: none;">
          <h4 class="upload-title">Upload Back Design</h4>
          <div class="file-drop-zone" id="back-drop-zone">
            <input type="file" id="backDesignUpload" accept="image/*,.ai,.eps,.pdf,.psd" multiple style="display: none;">
            <div class="upload-content" onclick="document.getElementById('backDesignUpload').click();">
              <button type="button" class="upload-btn">Choose file</button>
              <span class="upload-text">or drop file to upload</span>
            </div>
            <div class="file-preview" id="back-file-preview"></div>
          </div>
        </div>
      </div>

      <!-- Location Selectors -->
      <div class="location-selectors">
        <!-- Front Design Location -->
        <div class="location-section" id="front-location-section">
          <h3 class="section-heading">Where do you want your front design to go?</h3>
          <div class="radio-options">
            <label class="radio-option">
              <input type="radio" name="frontLocation" value="full-front" checked>
              <span class="radio-label">Full Front (Large and Centered)</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="frontLocation" value="left-chest">
              <span class="radio-label">Left Chest (Smaller)</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="frontLocation" value="other">
              <span class="radio-label">Other (please specify below)</span>
            </label>
          </div>
        </div>
        
        <!-- Back Design Location -->
        <div class="location-section" id="back-location-section" style="display: none;">
          <h3 class="section-heading">Where do you want your back design to go?</h3>
          <div class="radio-options">
            <label class="radio-option">
              <input type="radio" name="backLocation" value="full-back" checked>
              <span class="radio-label">Full Back (large and centered)</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="backLocation" value="other">
              <span class="radio-label">Other (please specify below)</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Color Selector (single color - swatches) -->
      <div class="color-selector-section">
        <h3 class="section-heading">Choose product color</h3>
        <div id="bundleColorSwatches" class="color-swatches">
          {% if product.options_by_name['Color'] %}
            {% assign color_values = product.options_by_name['Color'].values %}
            {% assign color_position = product.options_by_name['Color'].position | prepend: 'option' %}
            {% for value in color_values %}
              {% assign shown = false %}
              {% for v in product.variants %}
                {% if v[color_position] == value and shown == false %}
                  {% assign v_img = v.featured_image | default: product.featured_image %}
                  <button type="button" class="swatch" data-color="{{ value | escape }}" style="background-image:url('{{ v_img | image_url: width: 64 }}');" aria-label="{{ value }}"></button>
                  {% assign shown = true %}
                {% endif %}
              {% endfor %}
              {% unless shown %}
                <button type="button" class="swatch" data-color="{{ value | escape }}" style="background-color: {{ value | escape }};" aria-label="{{ value }}"></button>
              {% endunless %}
            {% endfor %}
          {% endif %}
        </div>
        <div class="selected-color-display" id="selected-color-display">
          <strong>Selected Color: <span id="selected-color-name">{% if product.options_by_name['Color'] %}{{ product.options_by_name['Color'].values.first }}{% else %}Default{% endif %}</span></strong>
        </div>
        <input type="hidden" id="bundleColorSelect" value="{% if product.options_by_name['Color'] %}{{ product.options_by_name['Color'].values.first | escape }}{% else %}Default{% endif %}">
      </div>

      <!-- Quantity Selection -->
      <div class="quantity-section" id="quantity-section">
        <h3 class="section-heading">Order Quantity</h3>
        {% assign minimum_qty = product.metafields.product.minimum | default: 36 %}
        <input type="hidden" id="minimumQty" value="{{ minimum_qty }}">
        <p class="quantity-subtitle">Minimum order quantity is {{ minimum_qty }} pieces. Enter your total quantity:</p>
        
        <div class="quantity-input-wrapper">
          <label for="totalQuantity" class="quantity-label">Total Quantity:</label>
          <input type="number" id="totalQuantity" name="totalQuantity" min="{{ minimum_qty }}" value="{{ minimum_qty }}" step="1" class="quantity-input">
          <span class="quantity-note">pieces</span>
        </div>

        <!-- Size breakdown input -->
        <div class="size-breakdown" id="size-breakdown">
          <h4 id="size-breakdown-title">Size Breakdown (Total: {{ minimum_qty }} pieces)</h4>
          <div class="size-inputs">
            <div class="size-input-group" id="size-input-group">
              {% if product.metafields.custom.size %}
                {% assign available_sizes = product.metafields.custom.size %}
                {% for size in available_sizes %}
                  {% assign default_qty = 0 %}
                  {% if forloop.index <= 3 and forloop.index > 1 %}
                    {% assign default_qty = 12 %}
                  {% endif %}
                  <label>{{ size | upcase }}: <input type="number" name="size_{{ size | downcase }}" min="0" value="{{ default_qty }}"></label>
                {% endfor %}
              {% else %}
                <!-- Fallback to standard sizes if metafield not set -->
                <label>XS: <input type="number" name="size_xs" min="0" value="0"></label>
                <label>S: <input type="number" name="size_s" min="0" value="12"></label>
                <label>M: <input type="number" name="size_m" min="0" value="12"></label>
                <label>L: <input type="number" name="size_l" min="0" value="12"></label>
                <label>XL: <input type="number" name="size_xl" min="0" value="0"></label>
                <label>2XL: <input type="number" name="size_2xl" min="0" value="0"></label>
                <label>3XL: <input type="number" name="size_3xl" min="0" value="0"></label>
              {% endif %}
            </div>
            <div class="size-total" id="size-total">Total: 36 / {{ minimum_qty }}</div>
          </div>
        </div>
        
        {% comment %} <div class="split-order">
          <label class="checkbox-option">
            <input type="checkbox" id="splitOrder">
            <span class="checkbox-label">Split my order into multiple shirt colors!</span>
          </label>
          <p class="split-note">Note: design AND ink colors must be the same on all shirts.</p>
        </div> {% endcomment %}
      </div>

      <!-- Production Timeline -->
      <div class="timeline-section">
        <h3 class="section-heading">Production Timeline</h3>
        <div class="timeline-options">
          <label class="timeline-option">
            <input type="radio" name="productionTimeline" value="standard" checked>
            <span class="timeline-label">Standard (7-10 Business Days) - Included</span>
          </label>
          <label class="timeline-option">
            <input type="radio" name="productionTimeline" value="rush">
            <span class="timeline-label">Rush (2-4 Business Days) - Extra $4.00 per unit</span>
          </label>
        </div>
      </div>

      <!-- Order Notes -->
      <div class="notes-section">
        <h3 class="section-heading">Order Notes</h3>
        <textarea class="order-notes" placeholder="Add any special instructions or notes here..."></textarea>
      </div>

      <!-- Pricing Summary -->
      <div class="pricing-summary" id="pricing-summary">
        <h3 class="section-heading">Pricing Breakdown</h3>
        <div class="pricing-details" id="pricing-details">
          <div class="pricing-line">
            <span>Base price (<span id="base-qty">{{ minimum_qty }}</span> pieces):</span>
            <span id="base-price">$564.86</span>
          </div>
          <div class="pricing-line" id="front-color-cost" style="display: none;">
            <span>Front print colors:</span>
            <span id="front-color-price">$0.00</span>
          </div>
          <div class="pricing-line" id="back-color-cost" style="display: none;">
            <span>Back print colors:</span>
            <span id="back-color-price">$0.00</span>
          </div>
          <div class="pricing-line" id="rush-cost" style="display: none;">
            <span>Rush processing:</span>
            <span id="rush-price">$0.00</span>
          </div>
          <div class="pricing-line total-line">
            <span><strong>Total:</strong></span>
            <span id="total-price"><strong>$564.86</strong></span>
          </div>
        </div>
      </div>

      <!-- Add to Cart Button -->
      <button type="button" class="add-to-cart-btn">Add to Cart</button>
    </div>
  </div>
</div>
